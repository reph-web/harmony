{% extends 'base.html.twig' %}

{% block title %}Hello ChatController!{% endblock %}

{% block body %}
<div>
<div class="card border-primary mt-3 bg-dark mb-3">
  <div class="card-header">
  <h3>{{chat.name}}<h3>
  </div>
  <div class="card-body">
    <p class="card-title">{{chat.description}}</p>
  </div>
</div>
<div>
    <ul class="list-group">
        {% for  message in messages|slice(-500) %}
            {% if  message.chat.id == chat.id %}
                <li class="alert alert-primary message-container p-0">
                <img class="minia" src="{{ asset(message.author.avatar, 'avatar') }}">
                <div class="text-container mt-2">
                    
                    {% if "ROLE_ADMIN" in message.author.roles %}
                    <a class="text-danger" href="{{ path('app_profilePage', {'username' : message.author.username}) }}">{{message.author.username}}</a>
                    {% else %}
                    <a href="{{ path('app_profilePage', {'username' : message.author.username}) }}">{{message.author.username}}</a>
                    {% endif %}
                    
                    <span class="ms-2">:</span>
                    <span class="ms-2">{{message.content}}</span>
                    {% if is_granted("ROLE_ADMIN") or app.user.username ==  message.author.username %}
                    <a class="ms-2" href="{{ path('app_deleteMessage', {'id' : message.id})}}"><button type="button" class="btn btn-danger btn-sm">Delete</button></a>
                    {% endif %}
                </div>
                </li>
            {% endif %}
                
            </li>
        {% endfor %} 
    </ul>
<div class="sticky-bottom">
    {{form_start(messageForm)}}
        {{form_label(messageForm.content)}}
        {{form_widget(messageForm.content, { "attr": {"class":"form-control"}}) }}
        <button type="submit" class="btn btn-primary custon-form-btn">Send</button>
    {{form_end(messageForm)}}
</div>
</div>
{% endblock %}
